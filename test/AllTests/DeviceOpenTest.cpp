#include "CppUTest/TestHarness.h"
#include "CppUTestExt/MockSupport.h"
#include "CharDevMock.h"

extern "C" {
    #include "linux/module.h"
    #include "linux/fs.h"
    #include "main.h"
}

TEST_GROUP(DeviceOpenTest)
{
    void setup() {
    }

    void teardown() {
    }
};

TEST(DeviceOpenTest, fops_has_open)
{
    CHECK(tddmodule_fops.open);
}

TEST(DeviceOpenTest, open_succeeds)
{
    struct file fil;
    struct inode inode;

    CHECK(!tddmodule_dev_open( &inode, &fil));
}


TEST(DeviceOpenTest, open_initializes_filp_private_data)
{
    struct file fil;
    struct inode inode;

    tddmodule_dev_open( &inode, &fil);
    CHECK_EQUAL(&tddmodule_dev, fil.private_data);
}


